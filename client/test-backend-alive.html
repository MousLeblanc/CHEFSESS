<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Backend</title>
</head>
<body>
  <h1>Test Backend</h1>
  <button onclick="testBackend()">Tester Backend</button>
  <pre id="result"></pre>

  <script>
    async function testBackend() {
      const result = document.getElementById('result');
      result.textContent = 'ğŸ”„ Test en cours...\n';

      try {
        // Test 1: Serveur rÃ©pond ?
        result.textContent += '\n1ï¸âƒ£ Test connexion serveur...\n';
        const response = await fetch('/api/auth/check-token', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        });

        result.textContent += `   Statut: ${response.status}\n`;
        
        if (response.ok) {
          const data = await response.json();
          result.textContent += `   âœ… Serveur OK ! User: ${data.user?.name || data.user?.email}\n`;
        } else {
          result.textContent += `   âŒ Erreur: ${response.status} ${response.statusText}\n`;
        }

        // Test 2: RÃ©cupÃ©rer les commandes
        result.textContent += '\n2ï¸âƒ£ Test rÃ©cupÃ©ration commandes...\n';
        const ordersResponse = await fetch('/api/orders/customer-orders', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        });

        result.textContent += `   Statut: ${ordersResponse.status}\n`;
        
        if (ordersResponse.ok) {
          const ordersData = await ordersResponse.json();
          result.textContent += `   âœ… ${ordersData.data?.length || 0} commande(s) trouvÃ©e(s)\n`;
          
          if (ordersData.data && ordersData.data.length > 0) {
            const lastOrder = ordersData.data[0];
            result.textContent += `   DerniÃ¨re commande: ${lastOrder.orderNumber} (${lastOrder.status})\n`;
          }
        } else {
          result.textContent += `   âŒ Erreur: ${ordersResponse.status}\n`;
        }

        // Test 3: RÃ©cupÃ©rer le stock
        result.textContent += '\n3ï¸âƒ£ Test rÃ©cupÃ©ration stock...\n';
        const stockResponse = await fetch('/api/stock', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        });

        result.textContent += `   Statut: ${stockResponse.status}\n`;
        
        if (stockResponse.ok) {
          const stockData = await stockResponse.json();
          result.textContent += `   âœ… ${stockData.data?.length || 0} article(s) dans le stock\n`;
          
          if (stockData.data && stockData.data.length > 0) {
            result.textContent += `   Articles:\n`;
            stockData.data.slice(0, 5).forEach(item => {
              result.textContent += `      - ${item.name} (${item.quantity} ${item.unit})\n`;
            });
          }
        } else {
          result.textContent += `   âŒ Erreur: ${stockResponse.status}\n`;
        }

        result.textContent += '\nâœ… Tests terminÃ©s !\n';

      } catch (error) {
        result.textContent += `\nâŒ ERREUR CRITIQUE: ${error.message}\n`;
        result.textContent += `Stack: ${error.stack}\n`;
        result.textContent += '\nğŸ”´ Le serveur ne rÃ©pond pas ou n\'est pas dÃ©marrÃ© !\n';
      }
    }
  </script>
</body>
</html>

