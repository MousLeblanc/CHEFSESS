<!-- ===========================================
     G√âN√âRATEUR IA PERSONNALIS√â - FORMULAIRE
     =========================================== -->
<div class="card" style="margin-bottom: 2rem; border: 2px solid #10b981;">
  <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 1.5rem; margin: -2rem -2rem 2rem -2rem; border-radius: 12px 12px 0 0;">
    <h2 style="margin: 0; color: white;"><i class="fas fa-flask"></i> G√©n√©rateur IA Personnalis√©</h2>
    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Cr√©ez des menus sur-mesure avec des objectifs nutritionnels sp√©cifiques</p>
  </div>
  
  <form id="generate-custom-menu-form">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
      <div class="form-group">
        <label for="custom-menu-people"><i class="fas fa-users"></i> Nombre de personnes *</label>
        <input type="number" id="custom-menu-people" min="1" max="100" value="4" required>
      </div>
      <div class="form-group">
        <label for="custom-menu-type"><i class="fas fa-clock"></i> Type de repas *</label>
        <select id="custom-menu-type" required>
          <option value="d√©jeuner">D√©jeuner</option>
          <option value="d√Æner">D√Æner</option>
          <option value="petit-d√©jeuner">Petit-d√©jeuner</option>
          <option value="collation">Collation</option>
        </select>
      </div>
    </div>

    <div class="form-group" style="margin-bottom: 1.5rem;">
      <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;"><i class="fas fa-bullseye"></i> Objectifs Nutritionnels</label>
      <div id="nutritional-goals-container" style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
        <div id="nutritional-goals-list" style="margin-bottom: 1rem;">
          <p style="color: #6b7280; font-size: 0.9rem; margin: 0;">Aucun objectif ajout√©. Cliquez sur "Ajouter un objectif" ci-dessous.</p>
        </div>
        <button type="button" id="add-goal-btn" class="btn btn-outline" style="width: 100%; border-style: dashed; background: white; color: #10b981; border-color: #10b981;">
          <i class="fas fa-plus"></i> Ajouter un objectif nutritionnel
        </button>
      </div>
    </div>

    <div class="form-group" style="margin-bottom: 1.5rem;">
      <label for="custom-menu-restrictions"><i class="fas fa-ban"></i> Restrictions alimentaires (optionnel)</label>
      <select id="custom-menu-restrictions" multiple style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; min-height: 100px;">
        <option value="sans lactose">Sans lactose</option>
        <option value="sans gluten">Sans gluten</option>
        <option value="v√©g√©tarien">V√©g√©tarien</option>
        <option value="v√©g√©talien">V√©g√©talien</option>
        <option value="sans porc">Sans porc</option>
        <option value="sans arachides">Sans arachides</option>
        <option value="sans fruits √† coque">Sans fruits √† coque</option>
      </select>
      <small style="color: #6b7280;">Maintenez Ctrl (Cmd sur Mac) pour s√©lectionner plusieurs options</small>
    </div>

    <div class="form-group" style="margin-bottom: 1.5rem;">
      <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
        <input type="checkbox" id="use-stock-only" style="width: 18px; height: 18px; cursor: pointer;">
        <div style="flex: 1;">
          <strong style="color: #374151;"><i class="fas fa-box"></i> Utiliser uniquement le stock disponible</strong>
          <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 0.85rem;">
            Si activ√©, seules les recettes dont tous les ingr√©dients sont disponibles en stock seront propos√©es.
          </p>
        </div>
      </label>
    </div>

    <div style="background: #f0fdf4; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #10b981;">
      <p style="margin: 0; color: #047857; font-size: 0.9rem;">
        <i class="fas fa-lightbulb"></i> 
        <strong>Exemples d'utilisation :</strong><br>
        ‚Ä¢ Menu riche en prot√©ines (35g) pour seniors<br>
        ‚Ä¢ Menu anti-an√©mie (Fer 10mg + Vitamine C 80mg)<br>
        ‚Ä¢ Menu sant√© osseuse (Calcium 800mg + Vitamine D 15¬µg)<br>
        ‚Ä¢ Menu digestif (Fibres 12g)<br>
        ‚Ä¢ Menu immunitaire (Vitamine C 100mg + Zinc 8mg)
      </p>
    </div>

    <div id="custom-menu-progress" style="display: none; background: #fef3c7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
      <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: #92400e;"></i>
      <p style="margin: 0.5rem 0 0 0; color: #92400e; font-weight: 600;">G√©n√©ration en cours...</p>
      <p style="margin: 0.25rem 0 0 0; color: #666; font-size: 0.85rem;" id="custom-progress-text">Analyse des ingr√©dients disponibles...</p>
    </div>

    <button type="submit" style="width: 100%; padding: 1rem; font-size: 1.1rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
      <i class="fas fa-flask"></i> G√©n√©rer le menu personnalis√©
    </button>
  </form>

  <div id="custom-menu-results" style="display: none; margin-top: 2rem;"></div>

  <div id="generated-menus-list" style="margin-top: 2rem; display: none;">
    <h3 style="margin-bottom: 1rem; color: #374151;"><i class="fas fa-list"></i> Menus g√©n√©r√©s r√©cemment</h3>
    <div id="generated-menus-container" style="display: grid; gap: 1rem;"></div>
  </div>
</div>

<!-- ===========================================
     MODALE OBJECTIFS NUTRITIONNELS
     =========================================== -->
<div id="add-nutritional-goal-modal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
  <div class="modal-content" style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%;">
    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h3 style="margin: 0;">Ajouter un Objectif Nutritionnel</h3>
      <button class="modal-close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</button>
    </div>
    <div class="modal-body">
      <div id="modal-goals-list" style="margin-bottom: 1rem; display: none;">
        <h4 style="font-size: 0.95rem; color: #374151; margin-bottom: 0.5rem;">
          <i class="fas fa-check-circle" style="color: #10b981;"></i> Objectifs ajout√©s :
        </h4>
        <div id="modal-goals-container" style="background: #f0fdf4; padding: 0.75rem; border-radius: 6px; border: 1px solid #86efac; margin-bottom: 1rem;"></div>
      </div>
      
      <form id="add-nutritional-goal-form">
        <div class="form-group">
          <label for="goal-nutrient">Nutriment *</label>
          <select id="goal-nutrient" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
            <optgroup label="Prot√©ines & √ânergie">
              <option value="proteins">Prot√©ines (g)</option>
              <option value="calories">Calories (kcal)</option>
            </optgroup>
            <optgroup label="Vitamines">
              <option value="vitaminC">Vitamine C (mg)</option>
              <option value="vitaminD">Vitamine D (¬µg)</option>
              <option value="vitaminA">Vitamine A (¬µg)</option>
              <option value="vitaminE">Vitamine E (mg)</option>
              <option value="vitaminK">Vitamine K (¬µg)</option>
              <option value="vitaminB6">Vitamine B6 (mg)</option>
              <option value="vitaminB9">Vitamine B9 (¬µg)</option>
              <option value="vitaminB12">Vitamine B12 (¬µg)</option>
            </optgroup>
            <optgroup label="Min√©raux">
              <option value="iron">Fer (mg)</option>
              <option value="calcium">Calcium (mg)</option>
              <option value="magnesium">Magn√©sium (mg)</option>
              <option value="zinc">Zinc (mg)</option>
              <option value="phosphore">Phosphore (mg)</option>
              <option value="potassium">Potassium (mg)</option>
            </optgroup>
            <optgroup label="Autres">
              <option value="fibers">Fibres (g)</option>
              <option value="carbs">Glucides (g)</option>
              <option value="lipids">Lipides (g)</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label for="goal-target">Objectif par personne *</label>
          <input type="number" id="goal-target" min="0" step="0.1" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;" placeholder="Ex: 35">
        </div>
        <div style="background: #f3f4f6; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
          <p style="margin: 0; font-size: 0.85rem; color: #4b5563;">
            <strong>üí° Exemples de valeurs recommand√©es :</strong><br>
            ‚Ä¢ Prot√©ines : 25-40g<br>
            ‚Ä¢ Fer : 8-15mg<br>
            ‚Ä¢ Calcium : 800-1200mg<br>
            ‚Ä¢ Vitamine C : 80-120mg<br>
            ‚Ä¢ Fibres : 10-15g
          </p>
        </div>
      </form>
    </div>
    <div class="modal-footer" style="display: flex; gap: 1rem; margin-top: 1.5rem; justify-content: flex-end;">
      <button type="button" class="btn btn-secondary modal-close" style="background-color: #6c757d;">Annuler</button>
      <button type="submit" form="add-nutritional-goal-form" class="btn btn-outline" style="background: white; color: #10b981; border-color: #10b981;">
        <i class="fas fa-plus"></i> Ajouter un autre
      </button>
      <button type="button" id="add-goal-and-close-btn" class="btn btn-primary" style="background-color: #10b981;">
        <i class="fas fa-check"></i> Ajouter et fermer
      </button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container" class="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

<!-- ===========================================
     SCRIPTS (√Ä ajouter avant </body>)
     =========================================== -->
<!-- G√©n√©rateur de menu personnalis√© avec objectifs nutritionnels -->
<script src="js/custom-menu-generator.js"></script>
<script>
  // Initialiser le g√©n√©rateur de menu personnalis√©
  document.addEventListener('DOMContentLoaded', () => {
    customMenuGenerator.init();
  });
</script>

