<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef SES - Tableau de Bord Groupe</title>
    <link rel="stylesheet" href="CSS/main.css">
    <link rel="stylesheet" href="CSS/group-dashboard.css">
    <link rel="stylesheet" href="CSS/components/modal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="img/logo.png" alt="Chef SES" class="logo-img">
                <h1>Chef SES - Gestion Multi-Sites</h1>
            </div>
            <div class="user-info">
                <span id="user-name">Chargement...</span>
                <button onclick="showMyOrders()" class="btn btn-outline" style="background-color: #3498db;">
                    <i class="fas fa-receipt"></i> Mes Commandes
                </button>
                <div id="cart-badge" onclick="showCart()" style="position: relative; cursor: pointer; background: #27ae60; padding: 0.7rem 1rem; border-radius: 8px; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-shopping-cart" style="font-size: 1.2rem;"></i>
                    <span style="font-weight: 600;">Panier</span>
                    <span id="cart-count" style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border-radius: 50%; width: 24px; height: 24px; display: none; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">0</span>
                </div>
                <button id="logout-btn" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i> D√©connexion
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="tab-navigation">
        <button class="tab-btn active" data-tab="overview">
            <i class="fas fa-chart-pie"></i> Vue d'ensemble
        </button>
        <button class="tab-btn" data-tab="sites">
            <i class="fas fa-building"></i> Sites
        </button>
        <button class="tab-btn" data-tab="residents">
            <i class="fas fa-user-friends"></i> R√©sidents
        </button>
        <button class="tab-btn" data-tab="menus">
            <i class="fas fa-utensils"></i> Menus
        </button>
        <button class="tab-btn" data-tab="stock">
            <i class="fas fa-boxes"></i> Stock
        </button>
        <button class="tab-btn" data-tab="suppliers">
            <i class="fas fa-truck"></i> Fournisseurs
        </button>
        <button class="tab-btn" data-tab="sync">
            <i class="fas fa-sync"></i> Synchronisation
        </button>
        <button class="tab-btn" data-tab="reports">
            <i class="fas fa-chart-bar"></i> Rapports
        </button>
        <button class="tab-btn" data-tab="users">
            <i class="fas fa-users"></i> Utilisateurs
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Vue d'ensemble -->
        <div id="overview-tab" class="tab-content active">
            <div class="dashboard-grid">
                <!-- Statistiques g√©n√©rales -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-sites">-</h3>
                            <p>Sites actifs</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-residents">-</h3>
                            <p>R√©sidents</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-menus">-</h3>
                            <p>Menus cette semaine</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-sync"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="sync-rate">-</h3>
                            <p>Taux de synchronisation</p>
                        </div>
                    </div>
                </div>

                <!-- Tableau des sites -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-building"></i> √âtat des Sites</h2>
                        <button id="refresh-sites" class="btn btn-primary">
                            <i class="fas fa-refresh"></i> Actualiser
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table" id="sites-table">
                                <thead>
                                    <tr>
                                        <th>Site</th>
                                        <th>Type</th>
                                        <th>üë• R√©sidents</th>
                                        <th>Co√ªt mati√®re/jour</th>
                                        <th>Taux d'√©cart nutrition</th>
                                        <th>Alertes stock</th>
                                        <th>Derni√®re MAJ</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sites-tbody">
                                    <tr>
                                        <td colspan="8" class="text-center">Chargement...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des sites -->
        <div id="sites-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-building"></i> Gestion des Sites</h2>
                    <button id="add-site-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ajouter un Site
                    </button>
                </div>
                <div class="card-body">
                    <div class="sites-grid" id="sites-grid">
                        <!-- Les sites seront charg√©s ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des r√©sidents -->
        <div id="residents-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-user-friends"></i> R√©sidents - Regroupement par Profils Nutritionnels</h2>
                    <div class="header-actions">
                        <button id="refresh-residents" class="btn btn-primary">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                        <button id="export-residents-btn" class="btn btn-outline">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Statistiques rapides -->
                    <div class="residents-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="mini-stat-card" style="background: #e3f2fd; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1976d2;" id="total-residents-count">-</div>
                            <div style="color: #666; font-size: 0.9rem;">Total R√©sidents</div>
                        </div>
                        <div class="mini-stat-card" style="background: #fff3cd; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #856404;" id="allergies-groups-count">-</div>
                            <div style="color: #666; font-size: 0.9rem;">Groupes d'allergies</div>
                        </div>
                        <div class="mini-stat-card" style="background: #f8d7da; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #721c24;" id="restrictions-groups-count">-</div>
                            <div style="color: #666; font-size: 0.9rem;">Groupes de restrictions</div>
                        </div>
                        <div class="mini-stat-card" style="background: #d1ecf1; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #0c5460;" id="textures-groups-count">-</div>
                            <div style="color: #666; font-size: 0.9rem;">Types de textures</div>
                        </div>
                    </div>

                    <!-- Filtres -->
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                        <button class="filter-btn active" data-filter="all" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; background: #667eea; color: white; cursor: pointer;">
                            Tous les groupes
                        </button>
                        <button class="filter-btn" data-filter="allergies" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">
                            Allergies
                        </button>
                        <button class="filter-btn" data-filter="intolerances" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">
                            Intol√©rances
                        </button>
                        <button class="filter-btn" data-filter="restrictions" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">
                            Restrictions
                        </button>
                        <button class="filter-btn" data-filter="textures" style="padding: 0.5rem 1rem; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">
                            Textures
                        </button>
                    </div>

                    <!-- Groupes de r√©sidents -->
                    <div id="residents-groups-content">
                        <div class="loading-spinner" style="text-align: center; padding: 3rem; color: #667eea;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                            <p style="margin-top: 1rem;">Chargement des r√©sidents...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des menus -->
        <div id="menus-tab" class="tab-content">
            <!-- G√©n√©rateur IA Personnalis√© avec Crit√®res Nutritionnels -->
            <div class="card" style="margin-bottom: 2rem; border: 2px solid #10b981;">
                <div class="card-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <h2><i class="fas fa-flask"></i> G√©n√©rateur IA Personnalis√©</h2>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Cr√©ez des menus sur-mesure avec des objectifs nutritionnels sp√©cifiques</p>
                </div>
                <div class="card-body">
                    <form id="generate-custom-menu-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label for="custom-menu-people"><i class="fas fa-users"></i> Nombre de personnes *</label>
                                <input type="number" id="custom-menu-people" min="1" max="100" value="4" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                            </div>
                            <div class="form-group">
                                <label for="custom-menu-type"><i class="fas fa-clock"></i> Type de repas *</label>
                                <select id="custom-menu-type" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                                    <option value="d√©jeuner">D√©jeuner</option>
                                    <option value="d√Æner">D√Æner</option>
                                    <option value="petit-d√©jeuner">Petit-d√©jeuner</option>
                                    <option value="collation">Collation</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;"><i class="fas fa-bullseye"></i> Objectifs Nutritionnels</label>
                            <div id="nutritional-goals-container" style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid #e5e7eb;">
                                <!-- Les objectifs ajout√©s appara√Ætront ici -->
                                <div id="nutritional-goals-list" style="margin-bottom: 1rem;">
                                    <p style="color: #6b7280; font-size: 0.9rem; margin: 0;">Aucun objectif ajout√©. Cliquez sur "Ajouter un objectif" ci-dessous.</p>
                                </div>
                                <button type="button" id="add-goal-btn" class="btn btn-outline" style="width: 100%; border-style: dashed;">
                                    <i class="fas fa-plus"></i> Ajouter un objectif nutritionnel
                                </button>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label for="custom-menu-restrictions"><i class="fas fa-ban"></i> Restrictions alimentaires (optionnel)</label>
                            <select id="custom-menu-restrictions" multiple style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; min-height: 100px;">
                                <option value="sans lactose">Sans lactose</option>
                                <option value="sans gluten">Sans gluten</option>
                                <option value="v√©g√©tarien">V√©g√©tarien</option>
                                <option value="v√©g√©talien">V√©g√©talien</option>
                                <option value="sans porc">Sans porc</option>
                                <option value="sans arachides">Sans arachides</option>
                                <option value="sans fruits √† coque">Sans fruits √† coque</option>
                            </select>
                            <small style="color: #6b7280;">Maintenez Ctrl (Cmd sur Mac) pour s√©lectionner plusieurs options</small>
                        </div>

                        <div style="background: #f0fdf4; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #10b981;">
                            <p style="margin: 0; color: #047857; font-size: 0.9rem;">
                                <i class="fas fa-lightbulb"></i> 
                                <strong>Exemples d'utilisation :</strong><br>
                                ‚Ä¢ Menu riche en prot√©ines (35g) pour seniors<br>
                                ‚Ä¢ Menu anti-an√©mie (Fer 10mg + Vitamine C 80mg)<br>
                                ‚Ä¢ Menu sant√© osseuse (Calcium 800mg + Vitamine D 15¬µg)<br>
                                ‚Ä¢ Menu digestif (Fibres 12g)<br>
                                ‚Ä¢ Menu immunitaire (Vitamine C 100mg + Zinc 8mg)
                            </p>
                        </div>

                        <div id="custom-menu-progress" style="display: none; background: #fef3c7; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: #92400e;"></i>
                            <p style="margin: 0.5rem 0 0 0; color: #92400e; font-weight: 600;">G√©n√©ration en cours...</p>
                            <p style="margin: 0.25rem 0 0 0; color: #666; font-size: 0.85rem;" id="custom-progress-text">Analyse des ingr√©dients disponibles...</p>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
                            <i class="fas fa-flask"></i> G√©n√©rer le menu personnalis√©
                        </button>
                    </form>

                    <div id="custom-menu-results" style="display: none; margin-top: 2rem;">
                        <!-- Les r√©sultats seront affich√©s ici -->
                    </div>

                    <!-- Liste des menus g√©n√©r√©s -->
                    <div id="generated-menus-list" style="margin-top: 2rem; display: none;">
                        <h3 style="margin-bottom: 1rem; color: #374151;"><i class="fas fa-list"></i> Menus g√©n√©r√©s r√©cemment</h3>
                        <div id="generated-menus-container" style="display: grid; gap: 1rem;">
                            <!-- Les menus g√©n√©r√©s appara√Ætront ici -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- G√©n√©rateur IA Multi-Sites -->
            <div class="card" style="margin-bottom: 2rem; border: 2px solid #667eea;">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h2><i class="fas fa-wand-magic-sparkles"></i> G√©n√©rateur IA Multi-Sites</h2>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">G√©n√©ration intelligente de menus pour tous les sites actifs</p>
                </div>
                <div class="card-body">
                    <form id="generate-ai-menu-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label for="ai-menu-start-date"><i class="fas fa-calendar"></i> Date de d√©but *</label>
                                <input type="date" id="ai-menu-start-date" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                            </div>
                            <div class="form-group">
                                <label for="ai-menu-num-days"><i class="fas fa-calendar-week"></i> Nombre de jours *</label>
                                <input type="number" id="ai-menu-num-days" min="1" max="14" value="7" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label for="ai-menu-theme"><i class="fas fa-lightbulb"></i> Th√®me du menu (optionnel)</label>
                            <input type="text" id="ai-menu-theme" placeholder="Ex: Cuisine m√©diterran√©enne, Saveurs d'automne..." style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                        </div>

                        <div style="background: #e3f2fd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #2196f3;">
                            <p style="margin: 0; color: #1565c0; font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> 
                                <strong>L'IA prendra automatiquement en compte :</strong><br>
                                ‚Ä¢ Tous les profils nutritionnels des r√©sidents de tous les sites actifs<br>
                                ‚Ä¢ La disponibilit√© du stock centralis√©<br>
                                ‚Ä¢ Les allergies, intol√©rances et restrictions alimentaires<br>
                                ‚Ä¢ Les textures adapt√©es (normale, hach√©e, mix√©e)<br>
                                ‚Ä¢ Les conditions m√©dicales sp√©cifiques
                            </p>
                        </div>

                        <div id="ai-generation-progress" style="display: none; background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: #856404;"></i>
                            <p style="margin: 0.5rem 0 0 0; color: #856404; font-weight: 600;">G√©n√©ration en cours...</p>
                            <p style="margin: 0.25rem 0 0 0; color: #666; font-size: 0.85rem;" id="ai-progress-text">Analyse des profils nutritionnels...</p>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                            <i class="fas fa-wand-magic-sparkles"></i> G√©n√©rer les menus pour tous les sites
                        </button>
                    </form>

                    <div id="ai-menu-results" style="display: none; margin-top: 2rem;">
                        <!-- Les r√©sultats seront affich√©s ici -->
                    </div>
                </div>
            </div>

            <!-- Menus existants -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-utensils"></i> Menus Multi-Sites Existants</h2>
                    <div class="header-actions">
                        <select id="week-selector" class="form-select">
                            <option value="">S√©lectionner une semaine</option>
                        </select>
                        <button id="create-group-menu-btn" class="btn btn-outline">
                            <i class="fas fa-plus"></i> Cr√©er Menu Manuel
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="menus-content">
                        <p class="text-center">S√©lectionnez une semaine pour voir les menus</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion du stock -->
        <div id="stock-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-boxes"></i> Gestion du Stock Multi-Sites</h2>
                    <div class="header-actions">
                        <button id="add-stock-item-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Ajouter un article
                        </button>
                        <button id="refresh-stock-btn" class="btn btn-outline">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                        <button id="consolidate-stock-btn" class="btn btn-outline">
                            <i class="fas fa-layer-group"></i> Consolider le stock
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                        <input type="text" id="stock-search" placeholder="Rechercher..." style="flex: 1; padding: 0.8rem; border: 1px solid #ced4da; border-radius: 8px;">
                        <select id="stock-category-filter" style="padding: 0.8rem; border: 1px solid #ced4da; border-radius: 8px;">
                            <option value="">Toutes les cat√©gories</option>
                            <option value="legumes">L√©gumes</option>
                            <option value="viandes">Viandes</option>
                            <option value="poissons">Poissons</option>
                            <option value="produits-laitiers">Produits laitiers</option>
                            <option value="cereales">C√©r√©ales</option>
                            <option value="fruits">Fruits</option>
                            <option value="epices">√âpices</option>
                            <option value="boissons">Boissons</option>
                            <option value="autres">Autres</option>
                        </select>
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 1rem; text-align: left;">Nom</th>
                                <th style="padding: 1rem; text-align: left;">Cat√©gorie</th>
                                <th style="padding: 1rem; text-align: center;">Quantit√©</th>
                                <th style="padding: 1rem; text-align: center;">Expiration</th>
                                <th style="padding: 1rem; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stock-table-body">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 2rem; color: #666;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i><br>
                                    Chargement du stock...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Gestion des fournisseurs -->
        <div id="suppliers-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-truck"></i> Gestion des Fournisseurs</h2>
                    <div class="header-actions">
                        <button id="refresh-suppliers-btn" class="btn btn-primary">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                        <button id="cart-btn" class="btn btn-outline" style="position: relative; display: none;">
                            <i class="fas fa-shopping-cart"></i> Panier
                            <span id="cart-badge" style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">0</span>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="suppliers-list">
                        <p class="text-center" style="padding: 2rem; color: #666;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i><br>
                            Chargement des fournisseurs...
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Synchronisation -->
        <div id="sync-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-sync"></i> Synchronisation des Menus</h2>
                    <div class="header-actions">
                        <select id="sync-week-selector" class="form-select">
                            <option value="">S√©lectionner une semaine</option>
                        </select>
                        <button id="sync-all-btn" class="btn btn-primary">
                            <i class="fas fa-sync"></i> Synchroniser Tout
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="sync-status">
                        <p class="text-center">S√©lectionnez une semaine pour voir le statut de synchronisation</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rapports -->
        <div id="reports-tab" class="tab-content">
            <div class="reports-grid">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Rapport Nutritionnel</h2>
                    </div>
                    <div class="card-body">
                        <div id="nutrition-chart">
                            <p class="text-center">Chargement du rapport nutritionnel...</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-euro-sign"></i> Rapport des Co√ªts</h2>
                    </div>
                    <div class="card-body">
                        <div id="costs-chart">
                            <p class="text-center">Chargement du rapport des co√ªts...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des utilisateurs -->
        <div id="users-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-users"></i> Utilisateurs du Groupe</h2>
                    <button id="add-user-btn" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Ajouter Utilisateur
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table" id="users-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>R√¥les</th>
                                    <th>Site</th>
                                    <th>Derni√®re connexion</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <tr>
                                    <td colspan="6" class="text-center">Chargement...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Modal Ajouter Site -->
    <div id="add-site-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un Site</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-site-form">
                    <div class="form-group">
                        <label for="site-name">Nom du site *</label>
                        <input type="text" id="site-name" name="siteName" required>
                    </div>
                    <div class="form-group">
                        <label for="site-type">Type d'√©tablissement *</label>
                        <select id="site-type" name="type" required>
                            <option value="">S√©lectionner...</option>
                            <option value="ehpad">EHPAD</option>
                            <option value="hopital">H√¥pital</option>
                            <option value="ecole">√âcole</option>
                            <option value="collectivite">Collectivit√©</option>
                            <option value="maison_retraite">Maison de Retraite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="site-address">Adresse</label>
                        <textarea id="site-address" name="address" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="site-phone">T√©l√©phone</label>
                        <input type="tel" id="site-phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="site-email">Email</label>
                        <input type="email" id="site-email" name="email">
                    </div>
                    <div class="form-group">
                        <label for="sync-mode">Mode de synchronisation</label>
                        <select id="sync-mode" name="syncMode">
                            <option value="auto">Automatique</option>
                            <option value="manual">Manuel</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Annuler</button>
                <button type="submit" form="add-site-form" class="btn btn-primary">Cr√©er le Site</button>
            </div>
        </div>
    </div>

    <!-- Modal Cr√©er Menu Groupe -->
    <div id="create-group-menu-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Cr√©er un Menu Groupe</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-group-menu-form">
                    <div class="form-group">
                        <label for="menu-label">Nom du menu *</label>
                        <input type="text" id="menu-label" name="label" required>
                    </div>
                    <div class="form-group">
                        <label for="menu-week">Semaine *</label>
                        <input type="week" id="menu-week" name="yearWeek" required>
                    </div>
                    <div class="form-group">
                        <label for="menu-theme">Th√®me</label>
                        <input type="text" id="menu-theme" name="theme">
                    </div>
                    <div class="form-group">
                        <label>Plats de la semaine</label>
                        <div id="menu-entries">
                            <!-- Les entr√©es de menu seront ajout√©es ici -->
                        </div>
                        <button type="button" id="add-menu-entry" class="btn btn-outline">
                            <i class="fas fa-plus"></i> Ajouter un plat
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Annuler</button>
                <button type="submit" form="create-group-menu-form" class="btn btn-primary">Cr√©er le Menu</button>
            </div>
        </div>
    </div>

    <!-- Modal Ajouter Objectif Nutritionnel -->
    <div id="add-nutritional-goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un Objectif Nutritionnel</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-nutritional-goal-form">
                    <div class="form-group">
                        <label for="goal-nutrient">Nutriment *</label>
                        <select id="goal-nutrient" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                            <optgroup label="Prot√©ines & √ânergie">
                                <option value="proteins">Prot√©ines (g)</option>
                                <option value="calories">Calories (kcal)</option>
                            </optgroup>
                            <optgroup label="Vitamines">
                                <option value="vitaminC">Vitamine C (mg)</option>
                                <option value="vitaminD">Vitamine D (¬µg)</option>
                                <option value="vitaminA">Vitamine A (¬µg)</option>
                                <option value="vitaminE">Vitamine E (mg)</option>
                                <option value="vitaminK">Vitamine K (¬µg)</option>
                                <option value="vitaminB6">Vitamine B6 (mg)</option>
                                <option value="vitaminB9">Vitamine B9 (¬µg)</option>
                                <option value="vitaminB12">Vitamine B12 (¬µg)</option>
                            </optgroup>
                            <optgroup label="Min√©raux">
                                <option value="iron">Fer (mg)</option>
                                <option value="calcium">Calcium (mg)</option>
                                <option value="magnesium">Magn√©sium (mg)</option>
                                <option value="zinc">Zinc (mg)</option>
                                <option value="phosphore">Phosphore (mg)</option>
                                <option value="potassium">Potassium (mg)</option>
                            </optgroup>
                            <optgroup label="Autres">
                                <option value="fibers">Fibres (g)</option>
                                <option value="carbs">Glucides (g)</option>
                                <option value="lipids">Lipides (g)</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="goal-target">Objectif par personne *</label>
                        <input type="number" id="goal-target" min="0" step="0.1" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;" placeholder="Ex: 35">
                    </div>
                    <div style="background: #f3f4f6; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <p style="margin: 0; font-size: 0.85rem; color: #4b5563;">
                            <strong>üí° Exemples de valeurs recommand√©es :</strong><br>
                            ‚Ä¢ Prot√©ines : 25-40g<br>
                            ‚Ä¢ Fer : 8-15mg<br>
                            ‚Ä¢ Calcium : 800-1200mg<br>
                            ‚Ä¢ Vitamine C : 80-120mg<br>
                            ‚Ä¢ Fibres : 10-15g
                        </p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Annuler</button>
                <button type="submit" form="add-nutritional-goal-form" class="btn btn-primary">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <!-- Scripts principaux -->
    <script type="module">
        // Imports des modules ES6
        import { loadSuppliersData, renderSuppliersList, updateCartCount, initSupplierTab } from './JS/supplier-common.js';
        import { loadStockData, renderStockTable, initStockTab, showAddStockModal, filterStock, consolidateStock } from './JS/stock-common.js';
        import { loadCustomerOrders, initOrderTracking, loadOrdersBadgeOnly } from './JS/order-tracking.js';
        
        // Rendre les fonctions accessibles globalement
        window.loadSuppliersData = loadSuppliersData;
        window.renderSuppliersList = renderSuppliersList;
        window.updateCartCount = updateCartCount;
        window.initSupplierTab = initSupplierTab;
        
        window.loadStockData = loadStockData;
        window.renderStockTable = renderStockTable;
        window.initStockTab = initStockTab;
        window.showAddStockModal = showAddStockModal;
        window.filterStock = filterStock;
        window.consolidateStock = consolidateStock;
        
        window.loadCustomerOrders = loadCustomerOrders;
        window.initOrderTracking = initOrderTracking;
        window.loadOrdersBadgeOnly = loadOrdersBadgeOnly;
        
        // Initialiser le syst√®me de commandes et le badge
        initOrderTracking();
        
        console.log('‚úÖ Modules supplier, stock et orders charg√©s');
    </script>
    
    <script src="js/group-dashboard.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/toast.js"></script>
    
    <!-- Gestion des commandes et du panier -->
    <script>
        window.showMyOrders = function() {
            console.log('üìã Ouverture de la modale Mes Commandes');
            
            // Cr√©er la modale
            const modal = document.createElement('div');
            modal.id = 'orders-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 2000; overflow: auto;';
            
            modal.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 1200px; width: 95%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0; color: #667eea;">
                            <i class="fas fa-receipt"></i> Mes Commandes
                        </h2>
                        <button onclick="window.closeOrdersModal()" style="background: #e74c3c; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; color: white;">
                            <i class="fas fa-times"></i> Fermer
                        </button>
                    </div>
                    
                    <!-- Filtres -->
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; padding-bottom: 1rem; border-bottom: 2px solid #e0e0e0;">
                        <button onclick="window.loadCustomerOrders('all')" data-filter="all" class="filter-btn active" style="padding: 0.5rem 1rem; border: 2px solid #667eea; background: #667eea; color: white; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            Toutes <span class="filter-count" style="background: rgba(255,255,255,0.3); padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.85em;">0</span>
                        </button>
                        <button onclick="window.loadCustomerOrders('pending')" data-filter="pending" class="filter-btn" style="padding: 0.5rem 1rem; border: 2px solid #f39c12; background: white; color: #f39c12; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            ‚è≥ En attente <span class="filter-count" style="background: rgba(243,156,18,0.1); padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.85em;">0</span>
                        </button>
                        <button onclick="window.loadCustomerOrders('confirmed')" data-filter="confirmed" class="filter-btn" style="padding: 0.5rem 1rem; border: 2px solid #3498db; background: white; color: #3498db; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            üî® En cours <span class="filter-count" style="background: rgba(52,152,219,0.1); padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.85em;">0</span>
                        </button>
                        <button onclick="window.loadCustomerOrders('ready')" data-filter="ready" class="filter-btn" style="padding: 0.5rem 1rem; border: 2px solid #9b59b6; background: white; color: #9b59b6; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            üì¶ Pr√™tes <span class="filter-count" style="background: rgba(155,89,182,0.1); padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.85em;">0</span>
                        </button>
                        <button onclick="window.loadCustomerOrders('delivered')" data-filter="delivered" class="filter-btn" style="padding: 0.5rem 1rem; border: 2px solid #27ae60; background: white; color: #27ae60; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            ‚úÖ Livr√©es <span class="filter-count" style="background: rgba(39,174,96,0.1); padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.85em;">0</span>
                        </button>
                        <button onclick="window.loadCustomerOrders('issue')" data-filter="issue" class="filter-btn" style="padding: 0.5rem 1rem; border: 2px solid #e74c3c; background: white; color: #e74c3c; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            ‚ö†Ô∏è Probl√®mes <span class="filter-count" style="background: rgba(231,76,60,0.1); padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.85em;">0</span>
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <button onclick="window.loadCustomerOrders()" style="background-color: #3498db; padding: 0.75rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: 500;">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                        <span id="orders-count" style="color: #666; font-weight: 500;"></span>
                    </div>
                    
                    <div id="customer-orders-list" style="margin-top: 1rem; overflow-y: auto; flex: 1;">
                        <p style="text-align: center; padding: 2rem; color: #666;">
                            <i class="fas fa-spinner fa-spin"></i> Chargement des commandes...
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Ajouter le style pour les boutons actifs
            const style = document.createElement('style');
            style.textContent = `
                .filter-btn.active {
                    background: #667eea !important;
                    color: white !important;
                }
                .filter-btn.active .filter-count {
                    background: rgba(255,255,255,0.3) !important;
                    color: white !important;
                }
                .filter-btn:hover {
                    opacity: 0.8;
                    transform: translateY(-1px);
                    transition: all 0.2s;
                }
            `;
            document.head.appendChild(style);
            
            // Charger les commandes
            if (typeof window.loadCustomerOrders === 'function') {
                window.loadCustomerOrders();
            }
        };
        
        window.closeOrdersModal = function() {
            const modal = document.getElementById('orders-modal');
            if (modal) {
                modal.remove();
            }
        };
        
        window.showCart = function() {
            // Importer et utiliser la fonction du module supplier-common
            import('./JS/supplier-common.js').then(module => {
                if (typeof module.showCart === 'function') {
                    module.showCart();
                }
            });
        };
    </script>
</body>
</html>
